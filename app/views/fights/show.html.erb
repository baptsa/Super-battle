<div class="container containers-show-score-bar">
  <div class="row">
    <div class="col-xs-12 col-sm-6 fighter-players text-center">
      <div id="my-progress1">
        <div id="my-bar1"></div>
      </div>
      <div class="image-player1">
        <%= image_tag @fight.challenger.profile_picture, class: "avatar-large-player1" %>
      </div>
      <div>
        <p id="player1-name"><%= @fight.challenger.username %></p>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6 text-center fighter-players">
      <div id="my-progress2">
        <div id="my-bar2"></div>
      </div>
      <div class="image-player2">
        <%= image_tag @fight.opponent.profile_picture, class: "avatar-large-player2" %>
      </div>
      <%= @fight.opponent.username %>
    </div>
  </div>
</div>

<div class="container containers-show-animation ">
  <div class="row">
    <div class="col-xs-4">
      <div class="text-center card-result-player1">
        <h2> <%= @fight.challenger.username %></h2>
        <div class="table-stat">
          <table>
            <tr>
              <td>Followers : </td>
              <td><span> <%= @fight.challenger.followed_by %> </span></td>
            </tr>
            <tr>
              <td>Posts : </td>
              <td><span> <%= @fight.challenger.media %> </span></td>
            </tr>
            <tr>
              <td>Engagement per post <br> (likes + comments) : </td>
              <td><span> <%= @fight.challenger.engagement %> </span></td>
            </tr>
            <tr>
              <td>Engagement per post <br> per 100 followers : </td>
              <td><span> <%= (( @fight.challenger.engagement.to_f / @fight.challenger.followed_by.to_f ) * 100).round(1) %> </span></td>
            </tr>
          </table>
        </div>
        <table>
          <tr>
            <td>SCORE</td>
            <td>CATEGORY</td>
          </tr>
          <tr>
            <td id="score-followers-player1" style="visibility:hidden;"><span><%= @fight.follower_score_challenger %> </span></td>
            <td>Followers</td>
           </tr>
           <tr>
            <td id="score-media-player1" style="visibility:hidden;" ><%= @fight.media_score_challenger %></span></td>
            <td>Posts</td>
           </tr>
           <tr>
            <td id="score-engagement-player1" style="visibility:hidden;" ><%= @fight.engagement_score_challenger %></span></td>
            <td>Engagement</td>
           </tr>
        </table>
        <h1 class=""> <span id="final-score-followers-player1" style="visibility:hidden;"> <%= @fight.final_score_challenger %> </span> </h1>
      </div>
    </div>
    <div class="col-xs-4">
        <div class="card">
          <div class="div-video">
            <div class="border-video">

              <% if @fight.follower_score_challenger > @fight.follower_score_opponent%>
              <%= video_tag('battle2.mp4', class: "styled_video_container", autoplay: true, loop: false, size: "300x300") %>
              <% else %>
              <%= video_tag('battle1.mp4', class: "styled_video_container", autoplay: true, loop: false, size: "300x300") %>
              <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-4">
      <div class="text-center card-result-player2">
        <h2> <%= @fight.opponent.username %></h2>
          <div class="table-stat">
            <table>
              <tr>
                <td>Followers : </td>
                <td><span> <%= @fight.opponent.followed_by %> </span></td>
              </tr>
              <tr>
                <td>Posts : </td>
                <td><span> <%= @fight.opponent.media %> </span></td>
              </tr>
              <tr>
                <td>Engagement per post <br> (likes + comments) : </td>
                <td><span> <%= @fight.opponent.engagement %> </span></td>
              </tr>
              <tr>
                <td>Engagement per post <br> per 100 followers : </td>
                <td><span> <%= (( @fight.opponent.engagement.to_f / @fight.opponent.followed_by.to_f ) * 100).round(1) %> </span></td>
              </tr>
            </table>
          </div>
        <table>
          <tr>
            <td>SCORE</td>
            <td>CATEGORY</td>
          </tr>
          <tr>
            <td id="score-followers-player2" style="visibility:hidden;"><span><%= @fight.follower_score_opponent %> </span></td>
            <td>Followers</td>
           </tr>
           <tr>
            <td id="score-media-player2" style="visibility:hidden;"><%= @fight.media_score_opponent %></span></td>
            <td>Posts</td>
           </tr>
           <tr>
            <td id="score-engagement-player2" style="visibility:hidden;"><%= @fight.engagement_score_opponent %></span></td>
            <td>Engagement</td>
           </tr>
        </table>
        <h1 class=""> <span id="final-score-followers-player2" style="visibility:hidden;""> <%= @fight.final_score_opponent %> </span> </h1>
      </div>
    </div>
  </div>
</div>


<script>

window.addEventListener("load", function(event) {
  movebar1('my-bar1', '#final-score-followers-player1', '#final-score-followers-player2');
  movebar2('my-bar2', '#final-score-followers-player1', '#final-score-followers-player2');
  show1('score-followers-player1');
  show1('score-followers-player2');
  show2('score-media-player1');
  show2('score-media-player2');
  show3('score-engagement-player1');
  show3('score-engagement-player2');
  show4('final-score-followers-player1');
  show4('final-score-followers-player2');
});

var timerShow1 = 1000;
var timerShow2 = 2000;
var timerShow3 = 3000;
var timerShow4 = 4000;
var timeOurPlayer1 = 1000;
var timeOurPlayer2 = 1000;
var barLoop = 0.5;


function show1(selector) {
  setTimeout(function(){
    document.getElementById(selector).style.visibility = "visible";
  },timerShow1);
}
function show2(selector) {
  setTimeout(function(){
    document.getElementById(selector).style.visibility = "visible";
  },timerShow2);
}
function show3(selector) {
  setTimeout(function(){
    document.getElementById(selector).style.visibility = "visible";
  },timerShow3);
}
function show4(selector) {
  setTimeout(function(){
    document.getElementById(selector).style.visibility = "visible";
  },timerShow4);
}

// lifebar Player 1
function movebar1(barSelector1, selector1, selector2) {
  setTimeout(function () {
    var bar1 = document.getElementById(barSelector1);
    var width = 100;
    var id = setInterval(frame, 40);
    function frame() {
      // debugger;
      var score1 = Number($(selector1).text());
      var score2 = Number($(selector2).text());
      var maxScore = Math.max(score1, score2);
      var minScore = Math.min(score1, score2);
      var barWinner = ((maxScore - minScore) / maxScore) * 100;
      var barLoser = 0;
      if (maxScore === score1) {
        if (width <= barWinner) {
        clearInterval(id);
        } else {
        width -= barLoop;
        bar1.style.width = width + '%';
        }
      } else {
        if (width <= barLoser) {
        clearInterval(id);
        } else {
        width -= barLoop;
        bar1.style.width = width + '%';
        }
      }
    }
  }, timeOurPlayer1);
}

//Lifebar Player 2
function movebar2(barSelector2, selector1, selector2) {
  setTimeout(function () {
    var bar2 = document.getElementById(barSelector2);
    var width = 100;
    var id = setInterval(frame, 40);
    function frame() {
      var score1 = Number($(selector1).text());
      var score2 = Number($(selector2).text());
      var maxScore = Math.max(score1, score2);
      var minScore = Math.min(score1, score2);
      var barWinner = ((maxScore - minScore) / maxScore) * 100;
      var barLoser = 0;
      if (score2 > score1) {
        if (width <= barWinner) {
        clearInterval(id);
        } else {
        width -= barLoop;
        bar2.style.width = width + '%';
        }
      } else {
        if (width < barLoser) {
        clearInterval(id);
        } else {
        width -= barLoop;
        bar2.style.width = width + '%';
        }
      }
    }
  }, timeOurPlayer2);
}
</script>


<!-- function move1(barSelector1, selector1, selector2) {
  setTimeout(function () {
    var bar1 = document.getElementById(barSelector1);
    // var bar2 = document.getElementById(barSelector2);
    var width = 100;
    var id = setInterval(frame, 40);

    function frame() {
      var score1 = Number($(selector1).text());
      var score2 = Number($(selector2).text());
      // calculation here
      var maxScore = Math.max(score1, score2);
      var minScore = Math.min(score1, score2);
      var barWinner = (maxScore - minScore) / maxScore;
      var barLoser = 0;

      if (score1 > score2) {
        if (width <= barWinner) {
        clearInterval(id);
        } else {
        width -= 0.4;
        bar1.style.width = width + '%';
        }
      } else {
        if (width < barLoser) {
        clearInterval(id);
        } else {
        width -= 0.4;
        bar1.style.width = width + '%';
        }
      }
    }
  }, 400);
} -->


<!-- function move(barSelector, selector) {
  setTimeout(function () {
    var bar = document.getElementById(barSelector);
    var width = 1;
    var id = setInterval(frame, 40);
    function frame() {
      var score1 = Number($(selector).text());
      var new_score = score1 //follow_score
      if (width >= new_score) {
        clearInterval(id);
      } else {
        width += 0.4;
        bar.style.width = width + '%';
      }
    }
  }, 400);
} -->






