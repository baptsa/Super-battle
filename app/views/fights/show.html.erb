<% content_for :meta_title, "#{@fight.challenger.username} VS #{@fight.opponent.username}" %>
<% content_for :meta_description, "Challenge your friends ! " %>
<% content_for :meta_image, @fight.challenger.profile_picture %>

<div class="container containers-show-score-bar">
  <div class="row">
     <div class="col-xs-12 col-sm-6 fighter-players text-center">
      <div id="bar-player1">
        <div id="progress-player1"></div>
      </div>
      <div class="image-player1">
        <%= image_tag @fight.challenger.profile_picture, class: "avatar-large-player1" %>
      </div>
      <%= @fight.challenger.username %>
    </div>
    <div class="col-xs-12 col-sm-6 text-center fighter-players">
      <div id="bar-player2">
        <div id="progress-player2"></div>
      </div>
      <div class="image-player2">
        <%= image_tag @fight.opponent.profile_picture, class: "avatar-large-player2" %>
      </div>
      <%= @fight.opponent.username %>
    </div>
  </div>
</div>

<div class="container" id="winner-name" style="visibility:hidden;">
  <div class="row">
    <div class="text-center title-style">
      <div>
        <% if @fight.final_score_challenger > @fight.final_score_opponent %>
          <h1 class="title-style"> #<%= @fight.challenger.username.upcase %> WINS </h1>
        <% else  %>
          <h1 class="title-style"> #<%= @fight.opponent.username.upcase %> WINS </h1>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="container-results containers-show-animation">
  <div class="results-red">
  <h3> Followers : <%= @fight.challenger.followed_by %></h3>
    <table class="table-score-red">
      <tr>
        <td>Followers Score<i class="fa fa-question-circle-o" aria-hidden="true"></i></td>
        <td id="score-followers-player1" style="visibility:hidden;"><span><%= @fight.follower_score_challenger %> </span></td>
       </tr>
       <tr>
        <td>Posts Score<i class="fa fa-question-circle-o" aria-hidden="true"></i></td>
        <td id="score-media-player1" style="visibility:hidden;" ><%= @fight.media_score_challenger %></span></td>
       </tr>
       <tr>
        <td>Engagement Score<i class="fa fa-question-circle-o" aria-hidden="true"></i></td>
        <td id="score-engagement-player1" style="visibility:hidden;" ><%= @fight.engagement_score_challenger %></span></td>
       </tr>
    </table>
    <h1 class=""> <span id="final-score-followers-player1" style="visibility:hidden;"> <%= @fight.final_score_challenger %> </span> </h1>
  </div>
  <div class="results-blue">
  <h3> Followers : <%= @fight.opponent.followed_by %></h3>
    <table class="table-score-blue">
      <tr>
        <td id="score-followers-player2" data-trigger="hover" style="visibility:hidden;"><span><%= @fight.follower_score_opponent %> </span></td>
        <td>Followers Score<i class="fa fa-question-circle-o" aria-hidden="true"></i></td>
       </tr>
       <tr>
        <td id="score-media-player2" style="visibility:hidden;"><%= @fight.media_score_opponent %></span></td>
        <td>Posts Score<i class="fa fa-question-circle-o" aria-hidden="true"></i></td>
       </tr>
       <tr>
        <td id="score-engagement-player2" style="visibility:hidden;"><%= @fight.engagement_score_opponent %></span></td>
        <td>Engagement Score<i class="fa fa-question-circle-o" aria-hidden="true"></i></td>
       </tr>
    </table>
    <h1 class=""><span id="final-score-followers-player2" style="visibility:hidden;"> <%= @fight.final_score_opponent %> </span> </h1>
  </div>
  <div class="video-position">
  <div class="div-video">
    <div class="border-video">
      <% if @fight.follower_score_challenger > @fight.follower_score_opponent%>
      <%= video_tag('battle2.mp4', class: "styled_video_container", autoplay: true, loop: false, size: "300x300") %>
      <% else %>
      <%= video_tag('battle1.mp4', class: "styled_video_container", autoplay: true, loop: false, size: "300x300") %>
      <% end %>
    </div>
  </div>
</div>
</div>

<div class="container-share">
  <h1 class="text-center title-style">SHARE THE RESULTS !!</h1>
  <div class="share">
    <h3 class="text-center"><i class="fa fa-facebook-official title-style" aria-hidden="true"></i></h3>
    <h3><i class="fa fa-twitter title-style" aria-hidden="true"></i></h3>
    <h3><i class="fa fa-instagram title-style" aria-hidden="true"></i></h3>
  </div>
  <h3 class="title-style text-center">Or with the following link !</h3>
  <h3 class="title-style text-center">www.share-your-battle/65.com</h3>
</div>

<a href="/">
<div class="button-container">
  <div class="button-start text-center">
    <%= submit_tag "New fight !", class: "btn-zguy" %>
  </div>
</div>
</a>

<script>
  var timerScoreFollowers = 1800;
var timerScorePosts = 3600;
var timerScoreEngagement = 5000;
var timerShowScore = 6200;
var timerWinnerName = 6700;
var startBarMovement1 = 1400;
var startBarMovement2 = 1400;
var barLoop = 0.7; //

window.addEventListener("load", function(event) {
  movebar1('progress-player1', '#final-score-followers-player1', '#final-score-followers-player2');
  movebar2('progress-player2', '#final-score-followers-player1', '#final-score-followers-player2');
  show('score-followers-player1', timerScoreFollowers);
  show('score-followers-player2', timerScoreFollowers);
  show('score-media-player1',timerScorePosts);
  show('score-media-player2',timerScorePosts);
  show('score-engagement-player1',timerScoreEngagement);
  show('score-engagement-player2',timerScoreEngagement);
  show('final-score-followers-player1',timerShowScore);
  show('final-score-followers-player2',timerShowScore);
  show('winner-name', timerWinnerName);
});

function show(selector, timer) {
  setTimeout(function(){
    document.getElementById(selector).style.visibility = "visible";
  },timer);
}

$('document').ready(function()Â {
  $('#score-followers-player2').popover({
    content: "This is calculated based on"
  });
});

$( "#score-followers-player2" ).hover(
  function() {
    $(this).popover({ content: "This is calculated based on" });
  });

// lifebar Player 1
function movebar1(barSelector1, selector1, selector2) {
  setTimeout(function () {
    var bar = document.getElementById(barSelector1);
    var width = 100;
    var id = setInterval(frame, 40);
    function frame() {
      // debugger;
      var score1 = Number($(selector1).text());
      var score2 = Number($(selector2).text());
      var maxScore = Math.max(score1, score2);
      var minScore = Math.min(score1, score2);
      var barWinner = ((maxScore - minScore) / maxScore) * 100;
      var barLoser = 0;
      if (maxScore === score1) {
        if (width <= barWinner) {
        clearInterval(id);
        } else {
        width -= barLoop;
        bar.style.width = width + '%';
        }
      } else {
        if (width <= barLoser) {
        clearInterval(id);
        } else {
        width -= barLoop;
        bar.style.width = width + '%';
        }
      }
    }
  }, startBarMovement1);
}

//Lifebar Player 2 -- Code is repeating.. Just one variable that is changing..
function movebar2(barSelector2, selector1, selector2) {
  setTimeout(function () {
    var bar = document.getElementById(barSelector2);
    var width = 100;
    var id = setInterval(frame, 40);
    function frame() {
      var score1 = Number($(selector1).text()); // enventually create a new method with these lines and call them in the function to avoid RY !
      var score2 = Number($(selector2).text());
      var maxScore = Math.max(score1, score2);
      var minScore = Math.min(score1, score2);
      var barWinner = ((maxScore - minScore) / maxScore) * 100;
      var barLoser = 0;
      if (maxScore === score2) {
        if (width <= barWinner) {
        clearInterval(id);
        } else {
        width -= barLoop;
        bar.style.width = width + '%';
        }
      } else {
        if (width < barLoser) {
        clearInterval(id);
        } else {
        width -= barLoop;
        bar.style.width = width + '%';
        }
      }
    }
  }, startBarMovement2);
}

  // setTimeout(function() {
  //   alert(" WE DON'T LIKE HOW YOU ARE USING INSTAGRAM AND YOU WILL NOT GET ACCESS OUR API, SORRY GUYS ! BE CAREFULL WITH YOUR GITHUB SETTINGS...");
  // }, 8000);
  // setTimeout(function() {
  //   window.location = "https://soundcloud.com/fantastic-mister-zguy";
  // }, 15000);

</script>
